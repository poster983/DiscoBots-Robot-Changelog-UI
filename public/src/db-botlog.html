<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">


<link rel="import" href="shared-styles.html">

<dom-module id="db-botlog">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
      paper-fab {
        position: fixed;
        right: 25px;
        bottom: 30px;
        background-color: var(--app-accent-color);
    }



    </style>
    <div id="logcardarea">
      <log-card id="log1" isnew editmode></log-card>
      <log-card id="log2" title="New Arm" desc="We replaced the old arm with a lighter one so the robot wont fall over.  Unfortunately, we had to move the motors." followup="programmers,design notebook" name="Joseph" ></log-card>
    </div>
    <!-- New Change -->
  <paper-fab icon="build"></paper-fab>
   



  </template>

  <script>
    class DbBotLog extends Polymer.Element {
      static get is() { return 'db-botlog'; }
      static get supThis() { return this; }
      ready() {
        super.ready();
        var supThis = this;
            
        socket.emit('chat message', 'hello');
        socket.on('chat message', function(msg){
          console.log(msg);
          supThis.$find('#log1').attr('desc', msg);

        });
        //Need Toast
        socket.on('save error', function(msg){
          console.error(msg);
        });

        //Get new Changes
        socket.on('new change', function(json){
          console.log(json._id);
          var NewLogCard = new LogCard();
          NewLogCard.title = json.title;
          NewLogCard.desc = json.desc;
          NewLogCard.followup = json.followup;
          NewLogCard.name = json.name;
          NewLogCard.date = json.date;
          NewLogCard.id = json._id;
          supThis.$.logcardarea.insertBefore(NewLogCard ,supThis.$.logcardarea.children[0]); 
        });

      }

    }
    
    window.customElements.define(DbBotLog.is, DbBotLog);

    //let jquery selectors work
    Node.prototype.$find = function(selector){
                  return jQuery(this.shadowRoot.querySelectorAll(selector))
     }
     /*
    DbBotLog.prototype.sendNewChangelog = function () {
            console.log(DbBotLog.$find('#log1').attr('output'))
          }
          */

    function sendNewChangelog(title, desc, followup, name, date) {
      console.log(title);
        var jsonArr = { 
          title: title,
          desc: desc,
          followup: followup,
          name: name,
          date: date
        }
       socket.emit('sent changelog', jsonArr);
      }
      



//.$find('#log1').attr('output')
  </script>
</dom-module>
